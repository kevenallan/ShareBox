<div class="add-arquivo">
    <input
        id="fileInput"
        class="none"
        placeholder="none"
        type="file"
        (change)="onFileSelected($event)"
        multiple
    />
    <p-button
        icon="pi pi-plus"
        [rounded]="true"
        [text]="true"
        [raised]="true"
        (click)="clickUploadFile()"
    />
</div>

<div class="card">
    <p-menubar [model]="items">
        <ng-template pTemplate="start">
            <div class="div-icon-box">
                <i class="pi pi-spin pi-box icon-box"></i> ShareBox
            </div>
        </ng-template>
        <ng-template pTemplate="end">
            <div class="flex align-items-center gap-2">
                <p-avatar
                    (click)="op.toggle($event)"
                    styleClass="cursor-pointer"
                    label="U"
                    shape="circle"
                >
                </p-avatar>

                <p-overlayPanel #op>
                    <p-button
                        (click)="sair()"
                        icon="pi pi-download"
                        [rounded]="true"
                        [text]="true"
                        [raised]="true"
                    />
                    <p-button
                        (onClick)="sair()"
                        icon="pi pi-upload"
                        [rounded]="true"
                        [text]="true"
                        [raised]="true"
                    />
                    <p-button
                        (onClick)="sair()"
                        icon="pi pi-pen-to-square"
                        [rounded]="true"
                        [text]="true"
                        [raised]="true"
                        [disabled]="true"
                    />
                </p-overlayPanel>
            </div>
        </ng-template>
    </p-menubar>
</div>

<div class="container-table">
    <div class="width-card">
        <p-card>
            <p-table
                [value]="arquivoList"
                [tableStyle]="{ 'min-width': '50rem' }"
                styleClass="p-datatable-sm"
                responsiveLayout="stack"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Arquivo</th>
                        <th>Nome</th>
                        <th>Extensão</th>
                        <th>Data Upload</th>
                        <th>Ações</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-arquivo>
                    <tr>
                        <!-- <td>
                            <img
                                [src]="preview(arquivo)"
                                width="50"
                                [alt]="arquivo.nome"
                                class="shadow-4"
                                title="arquivo"
                            />
                        </td> -->
                        <td>
                            <ng-container *ngIf="arquivo.previewSrc">
                                <img
                                    *ngIf="isImagemExtensao(arquivo.extensao)"
                                    [src]="arquivo.previewSrc"
                                    width="50"
                                    alt="{{ arquivo.nome }}"
                                />
                                <img
                                    *ngIf="isVideoExtensao(arquivo.extensao)"
                                    [src]="arquivo.previewSrc"
                                    (click)="abrirMidia(arquivo)"
                                    width="50"
                                    alt="{{ arquivo.nome }}"
                                    class="cursor-pointer"
                                />
                                <img
                                    *ngIf="isAudioExtensao(arquivo.extensao)"
                                    [src]="arquivo.previewSrc"
                                    (click)="abrirMidia(arquivo)"
                                    width="50"
                                    alt="{{ arquivo.nome }}"
                                    class="cursor-pointer"
                                />

                                <a
                                    *ngIf="arquivo.extensao === 'pdf'"
                                    [href]="arquivo.url"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    <img
                                        [src]="arquivo.previewSrc"
                                        width="50"
                                        [alt]="arquivo.nome"
                                        class="shadow-4"
                                        title="arquivo"
                                    />
                                </a>
                                <!-- ESLSE '-' -->
                                <img
                                    *ngIf="isArquivoGenerico(arquivo.extensao)"
                                    [src]="arquivo.previewSrc"
                                    width="50"
                                    alt="{{ arquivo.nome }}"
                                />
                            </ng-container>
                        </td>

                        <td class="text-truncate">{{ arquivo.nome }}</td>
                        <td class="text-truncate">{{ arquivo.extensao }}</td>
                        <td>
                            {{
                                arquivo.dataCriacao
                                    | localDateTimeFormat: 'dd/MM/yyyy HH:mm'
                            }}
                        </td>
                        <td>
                            <div class="flex align-items-center gap-2">
                                <p-button
                                    (click)="op.toggle($event)"
                                    icon="pi pi-cog"
                                    [rounded]="true"
                                    [text]="true"
                                    [raised]="true"
                                />

                                <p-overlayPanel #op>
                                    <p-button
                                        (onClick)="
                                            downloadFile(
                                                arquivo.nome,
                                                arquivo.extensao
                                            )
                                        "
                                        icon="pi pi-download"
                                        [rounded]="true"
                                        [text]="true"
                                        [raised]="true"
                                        pTooltip="Download"
                                        tooltipPosition="bottom"
                                    />
                                    <p-button
                                        (onClick)="clickUploadFile()"
                                        icon="pi pi-upload"
                                        [rounded]="true"
                                        [text]="true"
                                        [raised]="true"
                                        class="btn-acoes"
                                        pTooltip="Upload"
                                        tooltipPosition="bottom"
                                    />
                                    <p-button
                                        (onClick)="
                                            deletar(
                                                arquivo.nome,
                                                arquivo.extensao
                                            )
                                        "
                                        icon="pi pi-trash"
                                        [rounded]="true"
                                        [text]="true"
                                        [raised]="true"
                                        class="btn-acoes"
                                        pTooltip="Deletar"
                                        tooltipPosition="bottom"
                                    />
                                    <p-button
                                        (onClick)="sair()"
                                        icon="pi pi-pen-to-square"
                                        [rounded]="true"
                                        [text]="true"
                                        [raised]="true"
                                        [disabled]="true"
                                        class="btn-acoes"
                                        pTooltip="Editar"
                                        tooltipPosition="bottom"
                                    />
                                </p-overlayPanel>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-card>
    </div>
</div>

<app-dialog #dialog> </app-dialog>
